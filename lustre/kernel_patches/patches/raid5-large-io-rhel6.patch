Index: linux-2.6.32-71.7.1.el6.x86_64/drivers/md/raid5.c
===================================================================
--- linux-2.6.32-71.7.1.el6.x86_64.orig/drivers/md/raid5.c	2011-01-05 04:04:49.000000000 +0200
+++ linux-2.6.32-71.7.1.el6.x86_64/drivers/md/raid5.c	2011-01-05 04:19:28.000000000 +0200
@@ -5126,7 +5126,12 @@ static int run(mddev_t *mddev)
 	blk_queue_io_min(mddev->queue, chunk_size);
 	blk_queue_io_opt(mddev->queue, chunk_size *
 			 (conf->raid_disks - conf->max_degraded));
-
+	{
+	int stripe_size = conf->chunk_sectors * (conf->previous_raid_disks - conf->max_degraded);
+	 
+	blk_queue_max_hw_sectors(mddev->queue, stripe_size);
+	blk_queue_max_segments(mddev->queue, stripe_size);
+        }
 	list_for_each_entry(rdev, &mddev->disks, same_set)
 		disk_stack_limits(mddev->gendisk, rdev->bdev,
 				  rdev->data_offset << 9);
