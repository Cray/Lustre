Index: linux-stage/fs/ext4/mballoc.c
===================================================================
--- linux-stage.orig/fs/ext4/mballoc.c
+++ linux-stage/fs/ext4/mballoc.c
@@ -3952,7 +3952,9 @@
 
 	/* "free < pa->pa_free" means we maybe double alloc the same blocks,
 	 * otherwise maybe leave some free blocks unavailable, no need to BUG.*/
-	if ((free > pa->pa_free && !pa->pa_error) || (free < pa->pa_free)) {
+	if (atomic_read(&sb->s_active) > 0 &&
+			((free > pa->pa_free && !pa->pa_error) ||
+			(free < pa->pa_free))) {
 		ext4_error(sb, "pa free mismatch: [pa %p] "
 				"[phy %lu] [logic %lu] [len %u] [free %u] "
 				"[error %u] [inode %lu] [freed %u]", pa,
@@ -3969,7 +3971,8 @@
 		 * from the bitmap and continue.
 		 */
 	}
-	BUG_ON(pa->pa_free != free);
+	/* do not verify if the file system is being umounted */
+	BUG_ON(atomic_read(&sb->s_active) > 0 && pa->pa_free != free);
 	atomic_add(free, &sbi->s_mb_discarded);
 
 	return err;
